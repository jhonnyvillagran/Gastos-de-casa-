<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Gastos Pro - Mejorado (Tema Oscuro)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); /* Fondo oscuro */
            min-height: 100vh;
            color: #e0e0e0; /* Texto claro */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #e0e0e0;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .status-bar {
            background: rgba(26, 34, 46, 0.95); /* Fondo oscuro semitransparente */
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(50, 60, 80, 0.5);
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .status-item {
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(135deg, #5f2c82 0%, #49a09d 100%); /* Colores vibrantes para items */
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .status-item.savings {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .status-item.remaining {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .card {
            background: rgba(26, 34, 46, 0.95); /* Fondo oscuro semitransparente */
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(50, 60, 80, 0.5);
        }

        .card h2 {
            color: #a0a0a0; /* Texto claro para t√≠tulos de secci√≥n */
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #a0a0a0; /* Texto claro para labels */
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #3a475e; /* Borde oscuro */
            border-radius: 8px;
            font-size: 1rem;
            background-color: #2a334a; /* Fondo oscuro para inputs */
            color: #e0e0e0; /* Texto claro para inputs */
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea; /* Color de enfoque */
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .expense-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .expense-table th,
        .expense-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #3a475e; /* Borde oscuro para tabla */
            color: #e0e0e0; /* Texto claro para tabla */
        }

        .expense-table th {
            background: #2a334a; /* Fondo oscuro para encabezados de tabla */
            font-weight: 600;
            color: #a0a0a0;
        }

        .expense-table tr:hover {
            background: #1e2738; /* Fondo m√°s oscuro al pasar el rat√≥n */
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #a0a0a0;
        }

        .error-message {
            background: #4a1e1e; /* Fondo oscuro para errores */
            color: #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #e53e3e;
        }

        .success-message {
            background: #1e4a2a; /* Fondo oscuro para √©xito */
            color: #6bff9b;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #48bb78;
        }

        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            background: rgba(26, 34, 46, 0.9); /* Fondo oscuro semitransparente */
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 0.9rem;
            font-weight: 600;
            color: #e0e0e0;
        }

        .sync-status.syncing {
            background: #3a2a1e;
            color: #ffc107;
        }

        .sync-status.synced {
            background: #1e4a2a;
            color: #6bff9b;
        }

        .sync-status.error {
            background: #4a1e1e;
            color: #ff6b6b;
        }

        #daily-balance-info {
            background: #1e2738; /* Fondo oscuro para balance diario */
            color: #e0e0e0;
        }

        #daily-balance-info p strong {
            color: #a0a0a0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="sync-status" id="sync-status">üîÑ Sincronizando...</div>
    
    <div class="container">
        <div class="header">
            <h1>üí∞ Gestor de Gastos Pro</h1>
            <p>Versi√≥n mejorada con sincronizaci√≥n completa</p>
        </div>

        <div class="status-bar">
            <div class="status-grid">
                <div class="status-item savings">
                    <div>Ahorro Total</div>
                    <div id="total-savings">0.00 UYU</div>
                </div>
                <div class="status-item">
                    <div>Gastado (Mes)</div>
                    <div id="monthly-spent">0.00 UYU</div>
                </div>
                <div class="status-item remaining">
                    <div>Sueldo Restante</div>
                    <div id="remaining-salary">0.00 UYU</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚öôÔ∏è Configuraci√≥n General</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="monthly-salary">Sueldo Mensual (UYU)</label>
                    <input type="number" id="monthly-salary" placeholder="Ej: 40000">
                </div>
                <div class="form-group">
                    <label for="savings-percentage">Meta de Ahorro Autom√°tico (%)</label>
                    <input type="number" id="savings-percentage" placeholder="Ej: 10">
                </div>
                <div class="form-group">
                    <label for="usd-rate">1 D√≥lar (USD) = X Pesos (UYU)</label>
                    <input type="number" step="0.01" id="usd-rate" placeholder="Ej: 40.50">
                </div>
                <div class="form-group">
                    <label for="brl-rate">1 Real (BRL) = X Pesos (UYU)</label>
                    <input type="number" step="0.01" id="brl-rate" placeholder="Ej: 8.20">
                </div>
            </div>
            <button class="btn" onclick="app.saveSettings()">üíæ Guardar Configuraci√≥n</button>
        </div>

        <div class="card">
            <h2>üí∏ Movimientos de Ahorro Manual</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="savings-movement-amount">Monto (UYU)</label>
                    <input type="number" id="savings-movement-amount" placeholder="Ej: 200">
                </div>
                <div class="form-group">
                    <label for="savings-movement-type">Acci√≥n</label>
                    <select id="savings-movement-type">
                        <option value="add">A√±adir al Ahorro</option>
                        <option value="subtract">Quitar del Ahorro</option>
                    </select>
                </div>
            </div>
            <button class="btn btn-success" onclick="app.adjustManualSavings()">üí∞ Realizar Movimiento</button>
        </div>

        <div class="card">
            <h2>‚ûï Nuevo Gasto</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="expense-description">Descripci√≥n</label>
                    <input type="text" id="expense-description" placeholder="Ej: Caf√© y medialunas">
                </div>
                <div class="form-group">
                    <label for="expense-amount">Monto</label>
                    <input type="number" step="0.01" id="expense-amount" placeholder="Ej: 150">
                </div>
                <div class="form-group">
                    <label for="expense-currency">Moneda</label>
                    <select id="expense-currency">
                        <option value="UYU">Pesos Uruguayos (UYU)</option>
                        <option value="USD">D√≥lar (USD)</option>
                        <option value="BRL">Reales (BRL)</option>
                    </select>
                </div>
            </div>
            <button class="btn btn-success" onclick="app.addExpense()">üìù Agregar Gasto</button>
        </div>

        <div class="card">
            <h2>üìä Balance Diario</h2>
            <div class="form-group">
                <label for="daily-limit">L√≠mite de Gasto Diario (UYU)</label>
                <input type="number" id="daily-limit" placeholder="Ej: 1000">
            </div>
            <div id="daily-balance-info" style="margin-top: 15px; padding: 15px; background: #1e2738; border-radius: 8px;">
                <p><strong>Gastado hoy:</strong> <span id="today-spent">0.00 UYU</span></p>
                <p><strong>L√≠mite diario:</strong> <span id="daily-limit-display">0.00 UYU</span></p>
                <p><strong>Restante hoy:</strong> <span id="today-remaining">0.00 UYU</span></p>
            </div>
        </div>

        <div class="card">
            <h2>üìã Historial de Gastos</h2>
            <div id="expense-history-loader" class="loading">
                <p>üîÑ Cargando gastos...</p>
            </div>
            <div id="expense-table-container" style="display: none;">
                <table class="expense-table" id="expense-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripci√≥n</th>
                            <th>Monto Original</th>
                            <th>Moneda</th>
                            <th>Monto UYU</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="expense-table-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            googleWebAppUrl: 'https://script.google.com/macros/s/AKfycbzvl7XbADb3KNc5ZO97x1oH3uowkoDnRZvAP8wx1Zwnk8tHc9oNyW_EOQS1rNPHM9T2Vg/exec',
            settingsSheetName: 'Configuracion' // Nueva hoja para configuraciones
        };

        class PersonalFinanceAppMejorado {
            constructor() {
                this.expenses = [];
                this.settings = {
                    salary: 0,
                    savingsPercentage: 10,
                    dailyLimit: 0,
                    manualSavings: 0,
                    usdToUyu: 40.0,
                    brlToUyu: 8.0,
                };
                this.syncStatus = document.getElementById('sync-status');
                this.lastSyncTime = null;
            }

            async init() {
                this.showSyncStatus('syncing', 'üîÑ Inicializando...');
                try {
                    await this.loadSettingsFromCloud();
                    await this.fetchExpenses();
                    this.showSyncStatus('synced', '‚úÖ Sincronizado');
                } catch (error) {
                    console.error('Error en inicializaci√≥n:', error);
                    this.loadSettingsFromLocal(); // Fallback a localStorage
                    this.showSyncStatus('error', '‚ùå Error de conexi√≥n');
                }
                this.updateUI();
            }

            showSyncStatus(type, message) {
                this.syncStatus.className = `sync-status ${type}`;
                this.syncStatus.textContent = message;
            }

            // NUEVA FUNCI√ìN: Cargar configuraciones desde Google Sheets
            async loadSettingsFromCloud() {
                try {
                    const response = await fetch(`${CONFIG.googleWebAppUrl}?action=getSettings`);
                    if (!response.ok) throw new Error('Error al cargar configuraciones');
                    
                    const result = await response.json();
                    if (result.status === 'success' && result.settings) {
                        this.settings = { ...this.settings, ...result.settings };
                        // Tambi√©n guardar en localStorage como backup
                        localStorage.setItem('financeAppSettingsProV3', JSON.stringify(this.settings));
                    } else {
                        throw new Error('No se encontraron configuraciones en la nube');
                    }
                } catch (error) {
                    console.warn('Error cargando desde la nube, usando localStorage:', error);
                    this.loadSettingsFromLocal();
                }
                this.populateSettingsForm();
            }

            // Cargar configuraciones desde localStorage (fallback)
            loadSettingsFromLocal() {
                const savedSettings = JSON.parse(localStorage.getItem('financeAppSettingsProV3'));
                if (savedSettings) {
                    this.settings = { ...this.settings, ...savedSettings };
                }
                this.populateSettingsForm();
            }

            populateSettingsForm() {
                document.getElementById('monthly-salary').value = this.settings.salary || '';
                document.getElementById('savings-percentage').value = this.settings.savingsPercentage || '';
                document.getElementById('daily-limit').value = this.settings.dailyLimit || '';
                document.getElementById('usd-rate').value = this.settings.usdToUyu || '';
                document.getElementById('brl-rate').value = this.settings.brlToUyu || '';
            }

            // NUEVA FUNCI√ìN: Guardar configuraciones en Google Sheets
            async saveSettings() {
                this.showSyncStatus('syncing', 'üîÑ Guardando...');
                
                // Recoger datos del formulario
                this.settings.salary = parseFloat(document.getElementById('monthly-salary').value) || 0;
                this.settings.savingsPercentage = parseFloat(document.getElementById('savings-percentage').value) || 0;
                this.settings.dailyLimit = parseFloat(document.getElementById('daily-limit').value) || 0;
                this.settings.usdToUyu = parseFloat(document.getElementById('usd-rate').value) || 1;
                this.settings.brlToUyu = parseFloat(document.getElementById('brl-rate').value) || 1;

                try {
                    // Guardar en Google Sheets
                    const response = await fetch(CONFIG.googleWebAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'saveSettings',
                            settings: this.settings
                        })
                    });

                    if (!response.ok) throw new Error('Error al guardar en la nube');
                    
                    const result = await response.json();
                    if (result.status !== 'success') throw new Error(result.message);

                    // Tambi√©n guardar en localStorage como backup
                    localStorage.setItem('financeAppSettingsProV3', JSON.stringify(this.settings));
                    
                    this.showSyncStatus('synced', '‚úÖ Configuraci√≥n guardada');
                    this.showMessage('Configuraci√≥n guardada correctamente en la nube.', 'success');
                    
                } catch (error) {
                    console.error('Error guardando configuraciones:', error);
                    // Guardar solo en localStorage si falla la nube
                    localStorage.setItem('financeAppSettingsProV3', JSON.stringify(this.settings));
                    this.showSyncStatus('error', '‚ùå Error guardando');
                    this.showMessage('Configuraci√≥n guardada localmente. Error de conexi√≥n con la nube.', 'error');
                }
                
                this.updateUI();
            }

            convertToUYU(amount, currency) {
                if (currency === 'UYU') return amount;
                
                const usdRate = this.settings.usdToUyu || 1;
                const brlRate = this.settings.brlToUyu || 1;

                if (currency === 'USD') return amount * usdRate;
                if (currency === 'BRL') return amount * brlRate;
                
                return amount;
            }

            async adjustManualSavings() {
                const amountEl = document.getElementById('savings-movement-amount');
                const amount = parseFloat(amountEl.value) || 0;
                const type = document.getElementById('savings-movement-type').value;
                
                if (amount <= 0) {
                    this.showMessage("Introduce un monto v√°lido.", 'error');
                    return;
                }
                
                this.settings.manualSavings += (type === 'add' ? amount : -amount);
                
                // Guardar inmediatamente en la nube
                await this.saveSettingsToCloud();
                
                this.showMessage(`Movimiento de ${amount.toFixed(2)} UYU realizado en ahorros.`, 'success');
                amountEl.value = '';
                this.updateUI();
            }

            async saveSettingsToCloud() {
                try {
                    const response = await fetch(CONFIG.googleWebAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'saveSettings',
                            settings: this.settings
                        })
                    });
                    
                    localStorage.setItem('financeAppSettingsProV3', JSON.stringify(this.settings));
                } catch (error) {
                    console.error('Error guardando configuraciones:', error);
                }
            }

            async fetchExpenses() {
                try {
                    const response = await fetch(CONFIG.googleWebAppUrl);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const result = await response.json();
                    if (result.status === 'success') {
                        this.expenses = result.data.map((row, index) => ({
                            id: index + 2,
                            timestamp: new Date(row[0]),
                            description: row[1],
                            originalAmount: parseFloat(row[2]) || 0,
                            currency: row[3] || 'UYU',
                            amountUYU: parseFloat(row[4]) || 0
                        }));
                        
                        this.renderExpenseTable();
                        document.getElementById('expense-history-loader').style.display = 'none';
                        document.getElementById('expense-table-container').style.display = 'block';
                    } else {
                        throw new Error(result.message || 'Error desconocido');
                    }
                } catch (error) {
                    console.error('Error fetching expenses:', error);
                    this.showMessage('Error al cargar gastos: ' + error.message, 'error');
                    document.getElementById('expense-history-loader').innerHTML = 
                        '<p style="color: #e53e3e;">‚ùå Error al cargar gastos</p>';
                }
            }

            async addExpense() {
                const description = document.getElementById('expense-description').value.trim();
                const amount = parseFloat(document.getElementById('expense-amount').value) || 0;
                const currency = document.getElementById('expense-currency').value;

                if (!description || amount <= 0) {
                    this.showMessage('Por favor, completa todos los campos correctamente.', 'error');
                    return;
                }

                this.showSyncStatus('syncing', 'üîÑ Guardando gasto...');

                const amountUYU = this.convertToUYU(amount, currency);
                const now = new Date();
                const expenseData = [
                    now.toISOString(),
                    description,
                    amount,
                    currency,
                    amountUYU
                ];

                try {
                    const response = await fetch(CONFIG.googleWebAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'addExpense',
                            data: expenseData
                        })
                    });

                    if (!response.ok) throw new Error('Error de red');
                    
                    const result = await response.json();
                    if (result.status === 'success') {
                        this.showMessage('Gasto agregado correctamente.', 'success');
                        this.showSyncStatus('synced', '‚úÖ Gasto guardado');
                        
                        // Limpiar formulario
                        document.getElementById('expense-description').value = '';
                        document.getElementById('expense-amount').value = '';
                        document.getElementById('expense-currency').value = 'UYU';
                        
                        // Recargar gastos
                        await this.fetchExpenses();
                        this.updateUI();
                    } else {
                        throw new Error(result.message || 'Error desconocido');
                    }
                } catch (error) {
                    console.error('Error adding expense:', error);
                    this.showMessage('Error al agregar gasto: ' + error.message, 'error');
                    this.showSyncStatus('error', '‚ùå Error guardando');
                }
            }

            async deleteExpense(expenseId) {
                if (!confirm('¬øEst√°s seguro de que quieres eliminar este gasto?')) return;

                this.showSyncStatus('syncing', 'üîÑ Eliminando...');

                try {
                    const response = await fetch(CONFIG.googleWebAppUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'deleteExpense',
                            rowId: expenseId
                        })
                    });

                    if (!response.ok) throw new Error('Error de red');
                    
                    const result = await response.json();
                    if (result.status === 'success') {
                        this.showMessage('Gasto eliminado correctamente.', 'success');
                        this.showSyncStatus('synced', '‚úÖ Eliminado');
                        await this.fetchExpenses();
                        this.updateUI();
                    } else {
                        throw new Error(result.message || 'Error desconocido');
                    }
                } catch (error) {
                    console.error('Error deleting expense:', error);
                    this.showMessage('Error al eliminar gasto: ' + error.message, 'error');
                    this.showSyncStatus('error', '‚ùå Error eliminando');
                }
            }

            renderExpenseTable() {
                const tbody = document.getElementById('expense-table-body');
                tbody.innerHTML = '';

                if (this.expenses.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #718096;">No hay gastos registrados</td></tr>';
                    return;
                }

                // Ordenar por fecha (m√°s reciente primero)
                const sortedExpenses = [...this.expenses].sort((a, b) => b.timestamp - a.timestamp);

                sortedExpenses.forEach(expense => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.timestamp.toLocaleDateString('es-UY')}</td>
                        <td>${expense.description}</td>
                        <td>${expense.originalAmount.toFixed(2)}</td>
                        <td>${expense.currency}</td>
                        <td>${expense.amountUYU.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" 
                                    onclick="app.deleteExpense(${expense.id})">
                                üóëÔ∏è Eliminar
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            updateUI() {
                // Calcular totales
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                const monthlyExpenses = this.expenses.filter(expense => 
                    expense.timestamp.getMonth() === currentMonth && 
                    expense.timestamp.getFullYear() === currentYear
                );
                
                const monthlySpent = monthlyExpenses.reduce((sum, expense) => sum + expense.amountUYU, 0);
                const automaticSavings = (this.settings.salary * this.settings.savingsPercentage) / 100;
                const totalSavings = automaticSavings + this.settings.manualSavings;
                const remainingSalary = this.settings.salary - monthlySpent - automaticSavings;

                // Actualizar status bar
                document.getElementById('total-savings').textContent = `${totalSavings.toFixed(2)} UYU`;
                document.getElementById('monthly-spent').textContent = `${monthlySpent.toFixed(2)} UYU`;
                document.getElementById('remaining-salary').textContent = `${remainingSalary.toFixed(2)} UYU`;

                // Actualizar balance diario
                const today = new Date();
                const todayExpenses = this.expenses.filter(expense => 
                    expense.timestamp.toDateString() === today.toDateString()
                );
                const todaySpent = todayExpenses.reduce((sum, expense) => sum + expense.amountUYU, 0);
                const todayRemaining = this.settings.dailyLimit - todaySpent;

                document.getElementById('today-spent').textContent = `${todaySpent.toFixed(2)} UYU`;
                document.getElementById('daily-limit-display').textContent = `${this.settings.dailyLimit.toFixed(2)} UYU`;
                document.getElementById('today-remaining').textContent = `${todayRemaining.toFixed(2)} UYU`;
                
                // Cambiar color seg√∫n el estado
                const todayRemainingEl = document.getElementById('today-remaining');
                if (todayRemaining < 0) {
                    todayRemainingEl.style.color = '#ff6b6b'; /* Rojo para negativo */
                } else if (todayRemaining < this.settings.dailyLimit * 0.2) {
                    todayRemainingEl.style.color = '#ffc107'; /* Naranja para bajo */
                } else {
                    todayRemainingEl.style.color = '#6bff9b'; /* Verde para positivo */
                }
            }

            showMessage(message, type = 'info') {
                // Remover mensajes anteriores
                const existingMessages = document.querySelectorAll('.error-message, .success-message');
                existingMessages.forEach(msg => msg.remove());

                const messageEl = document.createElement('div');
                messageEl.className = type === 'error' ? 'error-message' : 'success-message';
                messageEl.textContent = message;

                // Insertar despu√©s del header
                const header = document.querySelector('.header');
                header.insertAdjacentElement('afterend', messageEl);

                // Remover despu√©s de 5 segundos
                setTimeout(() => {
                    messageEl.remove();
                }, 5000);
            }
        }

        // Inicializar la aplicaci√≥n
        const app = new PersonalFinanceAppMejorado();
        
        // Inicializar cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

        // Auto-sincronizaci√≥n cada 5 minutos
        setInterval(() => {
            app.loadSettingsFromCloud();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>

